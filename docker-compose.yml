version: '3.8'

services:
  # Service 1: The Python Web Application
  web:
    build: .
    # Map container port 8000 to host port 80 (where you access the app)
    ports:
      - "80:8000"
    # Link to the database service
    depends_on:
      - db
    # Pass environment variables to the Python app
    environment:
      # Use the service name 'db' as the hostname for the database
      DB_HOST: db
      # These credentials must match the ones set for the 'db' service
      POSTGRES_DB: hackathondb
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password

  # Service 2: The SQL Database Server (PostgreSQL)
  db:
    # Use the official PostgreSQL image (best practice)
    image: postgres:15-alpine
    # Define credentials (DO NOT use simple passwords in production)
    environment:
      POSTGRES_DB: hackathondb
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
    # Store database data persistently on your host machine
    volumes:
      - postgres_data:/var/lib/postgresql/data/

# Define a volume for persistent data storage
volumes:
  postgres_data: